## Описание проекта

Приложение представляет собой графическую игру «Кирпичи» с интерфейсом на `customtkinter`.  
Реализованы:
- авторизация и регистрация пользователей с валидацией данных;
- ведение персональной статистики (игры, победы, поражения);
- общая таблица лидеров по всем пользователям;
- отдельное учебное окно‑задача с игрой «Кирпичи»;
- современный темный UI с использованием кастомных виджетов и иконок.

Приложение может запускаться как из исходников (`.py`), так и в виде собранного исполняемого файла `.exe` (через PyInstaller). Логика работы с пользовательскими данными (`users.json`, `bricks_stats.json`) и ресурсами (папка `icons`, файл `app.ico`) специально адаптирована под оба варианта.

---

## Структура проекта

Основные файлы и директории:

- **`app.py`** – точка входа, главное окно приложения (`BricksGameApp`), навигация между экранами.
- **`auth.py`** – менеджер пользователей (`AuthManager`), регистрация, вход, хранение и обновление статистики, работа с `users.json`.
- **`screens.py`** – стартовый экран, экран входа и регистрации.
- **`game_screen.py`** – основной игровой экран со стеной кирпичей, ходами игрока и AI, доступом к статистике.
- **`stats_screen.py`** – окно с таблицей лидеров по всем пользователям.
- **`tasks/bricks_game.py`** – отдельное учебное окно‑задача с игрой «Кирпичи» и сохранением общей статистики в `bricks_stats.json`.
- **`config.py`** – общая конфигурация: цвета, шрифты, размеры, настройки игры, пути к иконкам и функция `get_base_dir()` для корректной работы ресурсов как в `.py`, так и в `.exe`.
- **`utils.py`** – загрузчик иконок `IconLoader` (поддержка SVG, кэширование, запасные текстовые иконки).
- **`icons/`** – SVG‑иконки, используемые в интерфейсе.
- **`req.txt`** – список внешних зависимостей Python.

Файлы данных (создаются при работе приложения):

- **`users.json`** – данные зарегистрированных пользователей и их персональная статистика.
- **`bricks_stats.json`** – общая статистика игры «Кирпичи» (окно из `tasks/bricks_game.py`).

---

## Требования

- Python 3.10+ (рекомендуется актуальная версия 3.10/3.11).
- Windows (ориентир – Windows 10/11).
- Установленные зависимости из `req.txt`.

### Установка зависимостей

Находясь в директории проекта `LAB1820`, выполните:

```bash
pip install -r req.txt
```

Убедитесь, что `pip` использует нужную версию Python (при необходимости используйте `python -m pip install -r req.txt`).

---

## Запуск приложения из исходников

Из корня проекта:

```bash
python app.py
```

После запуска откроется главное окно:
1. Стартовый экран с кнопкой «Начать».
2. Экран входа / регистрации.
3. После успешного входа – основной игровой экран.

Окно «Статистика» с таблицей лидеров доступно из верхней панели главного игрового экрана.

Отдельное учебное окно‑задача с игрой «Кирпичи» можно запустить из модуля `tasks/bricks_game.py` (по необходимости).

---

## Хранение данных и работа с JSON

В проекте используется один основной JSON‑файл:

- **`users.json`** – хранит учетные записи пользователей и их персональную статистику.  
  Путь к файлу формируется в `auth.py` функцией `get_users_file_path()`:
  - при запуске из исходников (`.py`) файл создается в директории проекта;
  - при запуске из собранного `.exe` – в той же папке, где лежит исполняемый файл.

---

## Работа с ресурсами (иконки, app.ico)

Все ресурсы (включая папку `icons` и файл `app.ico`) ищутся через функцию:

```python
from config import get_base_dir
```

Ключевая идея:

```python
def get_base_dir() -> Path:
    if getattr(sys, 'frozen', False) and hasattr(sys, '_MEIPASS'):
        return Path(sys._MEIPASS)
    return Path(__file__).resolve().parent
```

- В режиме `.py` базовая директория совпадает с местом расположения `config.py` (то есть корень проекта).
- В режиме `.exe` базовая директория указывает на временную папку PyInstaller (`sys._MEIPASS`), куда при сборке попадает папка `icons` и другие ресурсы.

Пути к иконкам строятся относительно `BASE_DIR`:

```python
BASE_DIR: Path = get_base_dir()
ICONS_DIR: Path = BASE_DIR / 'icons'
```

Загрузка иконки окна (пример `app.py`):

```python
icon_path = get_base_dir() / "app.ico"
self.iconbitmap(str(icon_path))
```

Благодаря этому, структура ресурсов работает одинаково как в исходниках, так и в собранном `.exe`.

---

## Сборка в exe через PyInstaller

Рекомендуемая команда (из корня проекта `LAB1820`):

```bash
pyinstaller --name LAB18-20 --onefile --noconsole --icon app.ico --add-data "icons;icons" app.py
```

Пояснения к параметрам:

- **`--name LAB18-20`** – имя итогового `.exe`.
- **`--onefile`** – сборка в один исполняемый файл вместо папки.
- **`--noconsole`** – скрывает консольное окно (актуально для GUI).
- **`--icon app.ico`** – иконка самого `.exe`.
- **`--add-data "icons;icons"`** – добавляет содержимое папки `icons` внутрь сборки; в режиме PyInstaller она попадает в `sys._MEIPASS/icons`, откуда ее читает `config.py`.
- Последний аргумент `app.py` – главный модуль (точка входа).

При необходимости, если PyInstaller будет ругаться на Pillow или customtkinter, можно добавить скрытый импорт:

```bash
pyinstaller --name LAB18-20 --onefile --noconsole --icon app.ico --add-data "icons;icons" --hidden-import "PIL._tkinter_finder" app.py
```

После успешной сборки итоговый файл будет находиться в каталоге `dist/LAB18-20.exe`.

---

## Использование spec‑файла

При первом запуске PyInstaller автоматически создаст файл `LAB18-20.spec`.  
Его можно использовать для более тонкой настройки сборки (например, добавление дополнительных данных или модулей).

Для сборки по уже существующему spec‑файлу:

```bash
pyinstaller LAB18-20.spec
```

При ручном редактировании spec‑файла важно сохранять добавление папки `icons` в раздел `datas`, чтобы ресурсы продолжали корректно подхватываться в `.exe`.

---

## Типичные сценарии использования

1. Установка зависимостей:  
   `pip install -r req.txt`

2. Запуск из исходников для разработки:  
   `python app.py`

3. Сборка стабильной версии для передачи пользователю:  
   `pyinstaller --name LAB18-20 --onefile --noconsole --icon app.ico --add-data "icons;icons" app.py`

4. Раздача пользователям:
   - скопировать `dist/LAB18-20.exe`;
   - при первом запуске рядом с `.exe` автоматически создадутся файлы `users.json` и `bricks_stats.json` (при соответствующих действиях в приложении).


